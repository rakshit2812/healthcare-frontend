<app-navbar></app-navbar>

<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
      </div>
      <div class="header-text">
        <h2>Doctor Dashboard</h2>
        <p class="header-subtitle">Manage appointments and provide prescriptions</p>
      </div>
    </div>
  </div>
  
  <div *ngIf="message" [class]="'message message-' + messageType">
    <svg class="message-icon" fill="currentColor" viewBox="0 0 20 20" *ngIf="messageType === 'success'">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
    </svg>
    <svg class="message-icon" fill="currentColor" viewBox="0 0 20 20" *ngIf="messageType === 'error'">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
    </svg>
    {{ message }}
  </div>
  
  <div class="tabs">
    <button 
      [class.active]="activeTab === 'appointments'"
      (click)="setTab('appointments')">
      <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      Today's Appointments
    </button>
    <button 
      [class.active]="activeTab === 'availability'"
      (click)="setTab('availability')">
      <svg class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      Set Availability
    </button>
  </div>
  
  <!-- Appointments Tab -->
  <div *ngIf="activeTab === 'appointments'" class="tab-content">
    <!-- Subtabs for filtering appointments -->
    <div class="subtabs">
      <button 
        [class.active]="appointmentSubTab === 'booked'"
        (click)="setAppointmentSubTab('booked')"
        class="subtab-btn">
        <svg class="subtab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        Booked <span class="badge">{{ getAppointmentCount('booked') }}</span>
      </button>
      <button 
        [class.active]="appointmentSubTab === 'completed'"
        (click)="setAppointmentSubTab('completed')"
        class="subtab-btn">
        <svg class="subtab-icon" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        Completed <span class="badge">{{ getAppointmentCount('completed') }}</span>
      </button>
      <button 
        [class.active]="appointmentSubTab === 'cancelled'"
        (click)="setAppointmentSubTab('cancelled')"
        class="subtab-btn">
        <svg class="subtab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        Cancelled <span class="badge">{{ getAppointmentCount('cancelled') }}</span>
      </button>
    </div>

    <div *ngIf="appointments.length === 0" class="card">
      <div class="empty-state">
        üìÖ No appointments found. Enjoy your day!
      </div>
    </div>
    
    <div *ngIf="getFilteredAppointments().length === 0 && appointments.length > 0" class="card">
      <div class="empty-state">
        No {{ appointmentSubTab }} appointments found.
      </div>
    </div>
    
    <div *ngIf="getFilteredAppointments().length > 0" class="appointments-grid">
      <div *ngFor="let apt of getFilteredAppointments()" class="appointment-card">
        <!-- Header with Patient Info -->
        <div class="appointment-header">
          <div class="appointment-avatar">
            {{ getPatientInitials(apt.patient.name) }}
          </div>
          <div class="appointment-patient-info">
            <h4 class="appointment-patient-name">{{ apt.patient.name }}</h4>
            <p class="appointment-patient-email">{{ apt.patient.email }}</p>
          </div>
          <span [class]="'appointment-status ' + apt.status.toLowerCase()">
            {{ apt.status }}
          </span>
        </div>
        
        <!-- Appointment Details -->
        <div class="appointment-details">
          <div class="appointment-detail-item">
            <div class="appointment-detail-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <div class="appointment-detail-content">
              <div class="appointment-detail-label">Date</div>
              <div class="appointment-detail-value">{{ formatDate(apt.datetime) }}</div>
            </div>
          </div>
          
          <div class="appointment-detail-item">
            <div class="appointment-detail-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div class="appointment-detail-content">
              <div class="appointment-detail-label">Time</div>
              <div class="appointment-detail-value">{{ formatTime(apt.datetime) }}</div>
            </div>
          </div>
          
          <div class="appointment-detail-item">
            <div class="appointment-detail-icon">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"/>
              </svg>
            </div>
            <div class="appointment-detail-content">
              <div class="appointment-detail-label">Appointment ID</div>
              <div class="appointment-detail-value">{{ apt._id }}</div>
            </div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="appointment-actions" *ngIf="apt.status === 'booked'">
          <button 
            class="btn btn-primary"
            (click)="openPrescriptionModal(apt)">
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
            </svg>
            Add Prescription
          </button>
        </div>
        <div class="appointment-actions" *ngIf="apt.status === 'completed'">
          <div class="completed-badge">
            <svg class="completed-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            Consultation Completed
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Availability Tab -->
  <div *ngIf="activeTab === 'availability'" class="tab-content">
    <div class="card">
      <div class="card-header-section">
        <div class="card-header-icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div>
          <h3>Set Your Availability</h3>
          <p class="card-subtitle">Configure your available time slots</p>
        </div>
      </div>
      
      <form (ngSubmit)="submitAvailability()">
        <div class="form-group">
          <label>üìÖ Date</label>
          <input 
            type="date" 
            [(ngModel)]="availabilityForm.date" 
            name="date"
            required>
        </div>
        
        <div class="form-group">
          <label>üïê Time Slots (comma separated)</label>
          <input 
            type="text" 
            [(ngModel)]="availabilityForm.slots" 
            name="slots"
            placeholder="e.g., 09:00, 09:30, 10:00, 10:30, 11:00"
            required>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          Set Availability
        </button>
      </form>
      
      <div class="availability-preview" *ngIf="availabilityForm.slots">
        <h4>Preview Slots:</h4>
        <div class="slot-preview">
          <span class="slot-tag" *ngFor="let slot of availabilityForm.slots.split(',')">
            {{ slot.trim() }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Prescription Modal -->
  <div *ngIf="showPrescriptionModal" class="modal-overlay" (click)="closePrescriptionModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-wrapper">
          <div class="modal-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
            </svg>
          </div>
          <h3 class="modal-title">Add Prescription</h3>
        </div>
        <button class="modal-close" (click)="closePrescriptionModal()">√ó</button>
      </div>

      <div class="modal-body">
        <div class="modal-patient-info">
          <h4>Patient: {{ selectedAppointment?.patient?.name }}</h4>
          <p>Email: {{ selectedAppointment?.patient?.email }}</p>
          <p>Appointment Time: {{ formatTime(selectedAppointment?.datetime) }}</p>
        </div>

        <form (ngSubmit)="submitPrescription()">
          <div class="form-group">
            <label>üìã Diagnosis Notes</label>
            <textarea 
              [(ngModel)]="prescriptionForm.notes" 
              name="notes"
              rows="4"
              placeholder="Enter diagnosis notes, symptoms, and treatment plan..."
              required></textarea>
          </div>
          
          <div class="form-group">
            <label>üíä Medicines (comma separated)</label>
            <input 
              type="text" 
              [(ngModel)]="prescriptionForm.medicines" 
              name="medicines"
              placeholder="e.g., Paracetamol 500mg, Ibuprofen 400mg, Amoxicillin 250mg"
              required>
          </div>
          
          <div class="modal-actions">
            <button type="submit" class="btn btn-primary">
              <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Submit & Complete Appointment
            </button>
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="closePrescriptionModal()">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>